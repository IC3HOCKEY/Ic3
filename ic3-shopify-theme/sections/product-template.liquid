<div class="product-container" itemscope itemtype="http://schema.org/Product">
  <div class="product-images">
    <div class="carousel">
      <div class="carousel-images">
        {% for image in product.images %}
          <div class="carousel-image">
            <img src="{{ image.src | img_url: '800x' }}" alt="{{ image.alt | escape }}">
          </div>
        {% endfor %}
      </div>
      <button class="control-btn prev" onclick="prevImage()">❮</button>
      <button class="control-btn next" onclick="nextImage()">❯</button>
    </div>
  </div>
  
  <div class="product-info">
    <h1 itemprop="name">{{ product.title }}</h1>
    
    <div class="price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
      <span class="price-regular">{{ product.price | money }}</span>
      {% if product.compare_at_price > product.price %}
        <span class="price-compare">{{ product.compare_at_price | money }}</span>
        <span class="sale-badge">SALE</span>
      {% endif %}
    </div>
    
    <div class="product-description" itemprop="description">
      {{ product.description }}
    </div>
    
    <form action="/cart/add" method="post" enctype="multipart/form-data" id="AddToCartForm">
      {% if product.variants.size > 1 %}
        <div class="product-variants">
          {% for option in product.options_with_values %}
            <div class="selector-wrapper">
              <label for="SingleOptionSelector-{{ forloop.index0 }}">
                {{ option.name }}
              </label>
              <select
                id="SingleOptionSelector-{{ forloop.index0 }}"
                data-index="option{{ forloop.index }}"
                class="single-option-selector">
                {% for value in option.values %}
                  <option
                    value="{{ value | escape }}"
                    {% if option.selected_value == value %}selected="selected"{% endif %}>
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <div class="quantity-selector">
        <button type="button" class="minus">-</button>
        <input type="number" id="Quantity" name="quantity" value="1" min="1" class="quantity-input">
        <button type="button" class="plus">+</button>
      </div>
      
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      <button type="submit" name="add" id="AddToCart" class="btn add-to-cart">
        Add to Cart - {{ product.price | money }}
      </button>
    </form>
  </div>
</div>

<style>
  .product-container {
    display: flex;
    flex-wrap: wrap;
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
    gap: 2rem;
  }
  
  .product-images, .product-info {
    flex: 1;
    min-width: 300px;
  }
  
  .carousel {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    overflow: hidden;
  }
  
  .carousel-images {
    display: flex;
    transition: transform 0.5s ease-in-out;
  }
  
  .carousel-image {
    min-width: 100%;
    flex-shrink: 0;
  }
  
  .carousel-image img {
    width: 100%;
    height: auto;
    display: block;
  }
  
  .control-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.8);
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 1.2rem;
  }
  
  .prev { left: 10px; }
  .next { right: 10px; }
  
  .price {
    font-size: 1.5rem;
    font-weight: bold;
    margin: 1rem 0;
  }
  
  .price-compare {
    text-decoration: line-through;
    color: #999;
    margin-right: 10px;
  }
  
  .sale-badge {
    background: #ff4136;
    color: white;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 0.8rem;
    vertical-align: middle;
  }
  
  .quantity-selector {
    display: flex;
    align-items: center;
    margin: 1.5rem 0;
  }
  
  .quantity-selector button {
    background: #f5f5f5;
    border: 1px solid #ddd;
    padding: 5px 15px;
    font-size: 1.2rem;
    cursor: pointer;
  }
  
  .quantity-input {
    width: 60px;
    text-align: center;
    padding: 5px;
    margin: 0 10px;
    border: 1px solid #ddd;
  }
  
  .add-to-cart {
    background: #000;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 1rem;
    cursor: pointer;
    width: 100%;
    transition: background 0.3s;
  }
  
  .add-to-cart:hover {
    background: #333;
  }
</style>

<script>
  // Carousel functionality
  let currentIndex = 0;
  const images = document.querySelectorAll('.carousel-image');
  const totalImages = images.length;
  
  function updateCarousel() {
    const carousel = document.querySelector('.carousel-images');
    carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
  }
  
  function nextImage() {
    currentIndex = (currentIndex + 1) % totalImages;
    updateCarousel();
  }
  
  function prevImage() {
    currentIndex = (currentIndex - 1 + totalImages) % totalImages;
    updateCarousel();
  }
  
  // Auto-advance carousel
  setInterval(nextImage, 5000);
  
  // Product variant selection
  document.addEventListener('DOMContentLoaded', function() {
    const variantSelects = document.querySelectorAll('.single-option-selector');
    
    variantSelects.forEach(select => {
      select.addEventListener('change', function() {
        const selectedOptions = [];
        variantSelects.forEach(select => {
          selectedOptions.push(select.value);
        });
        
        // Find matching variant
        const variant = {{ product.variants | json }}.find(variant => {
          return variant.title.includes(selectedOptions.join(' / '));
        });
        
        if (variant) {
          // Update price
          const priceElement = document.querySelector('.price-regular');
          if (priceElement) {
            priceElement.textContent = new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: '{{ shop.currency }}'
            }).format(variant.price / 100);
          }
          
          // Update add to cart button
          const addToCartButton = document.querySelector('.add-to-cart');
          if (addToCartButton) {
            addToCartButton.textContent = `Add to Cart - ${priceElement.textContent}`;
          }
          
          // Update variant ID in form
          const variantInput = document.querySelector('input[name="id"]');
          if (variantInput) {
            variantInput.value = variant.id;
          }
        }
      });
    });
  });
</script>
